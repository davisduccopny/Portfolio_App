<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porfolio admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.js"></script>
    <base href="http://localhost:8000/">
    <link rel="icon" type="image/png" href="./static/image/favicon-16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="./static/image/favicon-31.png" sizes="32x32">
    <link rel="stylesheet" href="./static/css/admin.css">
</head>
<body data-bs-theme="dark">
    <div class="container mt-5">
        
        <!-- Dropdown Menu -->
        <nav class="navbar navbar-expand-lg mb-4">
            <div class="container-fluid">
                <h2><a class="navbar-brand" href="#">Porfolio Panel</a></h2>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active bg-info bg-opacity-10 border-bottom border-2 border-info rounded-1" href="#" data-form="profileForm">Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-form="skillFormContainer">Skills</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-form="EducationFormContainer">Education</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-form="ProjectFormContainer">Project</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-form="ExperienceFormContainer">Experience</a>
                        </li>
                        <li class="nav-item">
                            <button id="toggleTheme" class="btn btn-info mt-2 mt-md-0 mt-lg-0 ms-md-1 ms-lg-1">
                                <i id="themeIcon" class="fa fa-moon"></i>
                            </button>
                        </li>
                    </ul>
                </div>
                
            </div>
            
        </nav>
        
        <!-- Profile Form -->
        <form id="profileForm" class="admin-form row g-3 p-2 bg-info bg-opacity-10 border border-info rounded-2 " enctype="multipart/form-data">
            <h3>Profile</h3>
            <div class="col-md-4"><label for="title" >Title:</label><input type="text" name="title" class="form-control" placeholder="Write title"></div>
            <div class="col-md-4"><label for="name">Name:</label><input type="text" name="name" class="form-control" placeholder="Write name"></div>
            <div class="col-md-4"><label for="email">Email:</label><input type="text" name="email" class="form-control" placeholder="Write email"></div>
            <div class="col-md-2"><label for="birthdate">Birthday:</label><input type="text" name="birthdate" class="form-control" placeholder="choose birthday"></div>
            <div class="col-md-6"><label for="degree">Degree:</label><input type="text" name="degree" class="form-control" placeholder="Write degree"></div>
            <div class="col-md-4"><label for="freelance">Freelance:</label><input type="text" name="freelance" class="form-control" placeholder="Write freelance"></div>
            <div class="col-md-4"><label for="phone">Phone:</label><input type="text" name="phone" class="form-control" placeholder="Write phone"></div>
            <div class="col-md-4"><label for="address">Address:</label><input type="text" name="address" class="form-control" placeholder="Write address"></div>
            <div class="col-md-4"><label for="google_map">Google Map:</label><input type="text" name="google_map" class="form-control" placeholder="Write google_map"></div>
            <div class="col-md-4"><label for="website">Website:</label><input type="text" name="website" class="form-control" placeholder="Write link website"></div>
            <div class="col-md-4"><label for="x_link">X:</label><input type="text" name="x_link" class="form-control" placeholder="Write link X"></div>
            <div class="col-md-4"><label for="finallyacebook_link">Facebook:</label><input type="text" name="finallyacebook_link" class="form-control" placeholder="Write link Facebook"></div>
            <div class="col-md-4"><label for="github_link">Github:</label><input type="text" name="github_link" class="form-control" placeholder="Write Github"></div>
            <div class="col-md-4"><label for="linkedin_link">Linkedin:</label><input type="text" name="linkedin_link" class="form-control" placeholder="Write link Linkedin"></div>
            <div class="col-md-4"><label for="instagram_link">Instagram:</label><input type="text" name="instagram_link" class="form-control" placeholder="Write link Instagram"></div>
            <div class="col-md-4"><label for="skype_link">Skype:</label><input type="text" name="skype_link" class="form-control" placeholder="Write skype link"></div>
            <div class="col-md-4"><label for="avatar">Avatar: </label><input type="file" name="avatar" class="form-control mb-2" placeholder="choose avatar" onchange=""><img id="avatarPreview" src="" alt="Avatar" width="100"></div>
            <div class="col-md-4"><label for="background">Background:</label><input type="file" name="background" class="form-control mb-2" placeholder="choose background image"><img id="backgroundPreview" src="" alt="Avatar" width="100"></div>
            <div class="col-md-3"><label for="clients">Clients Count</label><input type="number" min="0" max="100" name="clients" class="form-control" placeholder="Write Count project Count"></div>
            <div class="col-md-3"><label for="projects">Projects Count</label><input type="number" min="0" max="100" name="projects" class="form-control" placeholder="Write count hours"></div>
            <div class="col-md-3"><label for="hours">Hours Count</label><input type="number" min="0" max="100" name="hours" class="form-control" placeholder=" Write worker hours"></div>
            <div class="col-md-3"><label for="workers">Workers Count</label><input type="number" min="0" max="100" name="workers" class="form-control" placeholder="Write worker count"></div>
            <div class="mb-3"><label for="about">About:</label><textarea name="about" id="about" class="form-control"></textarea></div>
            <div class="mb-3"><label for="sumary">Sumary:</label><textarea name="sumary" id="sumary" class="form-control"></textarea></div>
            <div class="mb-3"><label for="des_about_1">Description 1:</label><textarea name="des_about_1" id="des_about_1" class="form-control"></textarea></div>
            <div class="mb-3"><label for="des_about_2">Description 2:</label><textarea name="des_about_2" id="des_about_2" class="form-control"></textarea></div>
            <div class="mb-3"><label for="des_about_3">Description 3:</label><textarea name="des_about_3" id="des_about_3" class="form-control"></textarea></div>
            <div class="mb-3"><label for="des_about_4">Description 4:</label><textarea name="des_about_4" id="des_about_4" class="form-control"></textarea></div>
            <div class="d-grid gap-2 col-6 mx-auto"><button type="submit" class="btn btn-primary">Save</button></div>
        </form>

        <!-- Skills Form -->
         <div class="admin-form d-none"  id="skillFormContainer">
            <!-- Nút Add cho Skills -->
            <button class="btn btn-success add-form mb-3" data-target="#skillForm">Add</button>
            <form id="skillForm" data-id="" class="d-none show-form-add row p-2 g-3 bg-info bg-opacity-10 border border-info rounded-2 my-2" enctype="multipart/form-data">
                <div class="d-flex flex-grow-1 justify-content-between">
                    <h3>Skills</h3>
                    <button class="btn btn-sm btn-danger cancel-form rounded-3"><i class="fa fa-close"></i></button>
                </div>
                <div class="col-md-6"><label for="skill">Skill:</label><input type="text" name="skill" class="form-control" placeholder="Write skill"></div>
                <div class="col-md-6"><label for="percentage">Percentage:</label><input type="number" name="percentage" class="form-control" placeholder="Write percentage"></div>
                <div class="d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1 px-5 btn-sm">Save</button>
                    <button type="button" class="btn btn-secondary flex-grow-1 px-5 cancel-form btn-sm">Cancel</button>
                </div>
            </form>
            <div class="table-responsive p-2 g-3 border border-info rounded-2 mb-2">
                <h3 class="border-bottom border-info border-3">List:</h3>
                <table class="table table-hover table-bordered table-skill-fech">
                    <thead class="table-info">
                        <tr>
                            <th>ID</th>
                            <th>Skill</th>
                            <th>Percentage</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Education Form -->
        <div class="admin-form d-none" id="EducationFormContainer">
            <button class="btn btn-success add-form mb-3" data-target="#educationForm">Add</button>
            <form id="educationForm" data-id="" class="d-none show-form-add row p-2 g-3 bg-info bg-opacity-10 border border-info rounded-2 my-2" enctype="multipart/form-data">
                <div class="d-flex flex-grow-1 justify-content-between">
                    <h3>Education</h3>
                    <button class="btn btn-sm btn-danger cancel-form rounded-3"><i class="fa fa-close"></i></button>
                </div>
                <div class="col-md-4"><label for="degree">Degree:</label><input type="text" name="degree" class="form-control" placeholder="Write Degree"></div>
                <div class="col-md-4"><label for="school">School:</label><input type="text" name="school" class="form-control" placeholder="Write School"></div>
                <div class="col-md-4"><label for="year">Year:</label><input type="text" name="year" class="form-control" placeholder="Write year"></div>
                <div class="mb-3"><label for="description">Description: </label><textarea name="description" id="description_edu" class="form-control summernote"></textarea></div>
                <div class="d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1 px-5 btn-sm">Save</button>
                    <button type="button" class="btn btn-secondary flex-grow-1 px-5 cancel-form btn-sm">Cancel</button>
                </div>
            </form>
            <div class="table-responsive p-2 g-3 border border-info rounded-2 mb-2">
                <h3 class="border-bottom border-info border-3">List:</h3>
                <table class="table table-hover table-bordered table-education-fech">
                    <thead class="table-info">
                        <tr>
                            <th>ID</th>
                            <th>Degree</th>
                            <th>School</th>
                            <th>Description</th>
                            <th>Year</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Project Form -->
         <div  class="admin-form d-none" id="ProjectFormContainer">
            <button class="btn btn-success add-form my-2" data-target="#projectForm">Add</button>
            <form id="projectForm" data-id="" class="d-none show-form-add row p-2 g-3 bg-info bg-opacity-10 border border-info rounded-2 my-2" enctype="multipart/form-data">
                <div class="d-flex flex-grow-1 justify-content-between">
                    <h3>Project</h3>
                    <button class="btn btn-sm btn-danger cancel-form rounded-3"><i class="fa fa-close"></i></button>
                </div>
                <div class="col-md-4"><label for="title">Title:</label><input type="text" name="title" class="form-control" placeholder="Write Title"></div>
                <div class="col-md-4"><label for="image">Image:</label><input type="file" name="image" multiple class="form-control mb-2" placeholder="Choose image"><img id="projectImagePreview" src="" alt="projectImagePreview" width="100"></div>
                <div class="col-md-4"><label for="client">Client:</label><input type="text" name="client" class="form-control" placeholder="Write Client"></div>
                <div class="col-md-4"><label for="project_date">Project date:</label><input type="date" name="project_date" class="form-control" placeholder="Choose project date"></div>
                <div class="col-md-4"><label for="github_link">Github:</label><input type="text" name="github_link" class="form-control" placeholder="Write github_link"></div>
                <div class="col-md-4">
                    <label for="category">Category:</label>
                    <select name="category" class="form-control" aria-placeholder="Choose category">
                        <option value="SQL">SQL</option>
                        <option value="PowerBI">PowerBI</option>
                        <option value="Python">Python</option>
                        <option value="Excel">Excel</option>
                    </select>
                </div>
                <div class="mb-3"><label for="description">Description:</label><textarea name="description" id="description_project" class="form-control summernote"></textarea></div>
                <div class="d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1 px-5 btn-sm">Save</button>
                    <button type="button" class="btn btn-secondary flex-grow-1 px-5 cancel-form btn-sm">Cancel</button>
                </div>
            </form>
            <div class="table-responsive p-2 g-3 border border-info rounded-2 my-2">
                <h3 class="border-bottom border-info border-3">List:</h3>
                <table class="table table-hover table-bordered table-projects-fech">
                    <thead class="table-info">
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Image</th>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Client</th>
                            <th>Github</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Experience Form -->
         <div class="admin-form d-none" id="ExperienceFormContainer">
            <button class="btn btn-success add-form my-2" data-target="#experienceForm">Add</button>
            <form id="experienceForm" data-id="" class="d-none show-form-add row p-2 g-3 bg-info bg-opacity-10 border border-info rounded-2 my-2"  enctype="multipart/form-data">
                <div class="d-flex flex-grow-1 justify-content-between">
                    <h3>Experience</h3>
                    <button class="btn btn-sm btn-danger cancel-form rounded-3"><i class="fa fa-close"></i></button>
                </div>
                <div class="col-md-6"><label for="position">Position:</label><input type="text" name="position" class="form-control" placeholder="write position"></div>
                <div class="col-md-6"><label for="company">Company:</label><input type="text" name="company" class="form-control" placeholder="write company"></div>
                <div class="col-md-6"><label for="start_date">Start Date:</label><input type="text" name="start_date" class="form-control" placeholder="choose start_date"></div>
                <div class="col-md-6">
                    <label for="end_date">End date:</label>
                    <input type="text" name="end_date" class="form-control mb-1" placeholder="choose end_date">
                    <label for="checkbox_endate">Present</label>
                    <input type="checkbox" name="checkbox_endate" id="checkbox_endate" class="form-check-input mb-1">
                </div>
                <div class="mb-1"><label for="description">Description:</label><textarea name="description" id="description_experience" class="form-control summernote"></textarea></div>
                <div class="d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1 px-5 btn-sm">Save</button>
                    <button type="button" class="btn btn-secondary flex-grow-1 px-5 cancel-form btn-sm">Cancel</button>
                </div>
            </form>
            <div class="table-responsive p-2 g-3 border border-info rounded-2 my-2">
                <h3 class="border-bottom border-info border-3">List:</h3>
                <table class="table table-hover table-bordered table-experience-fech">
                    <thead class="table-info">
                        <tr>
                            <th>ID</th>
                            <th>Position</th>
                            <th>Company</th>
                            <th>Description</th>
                            <th>Start date</th>
                            <th>End date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Spinner -->
        <div id="loadingSpinner" class="d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>  
    </div>
    <script>

        // Change theme
        document.addEventListener("DOMContentLoaded", function() {
            document.body.classList.add('dark-mode');
            document.getElementById("toggleTheme").addEventListener("click", function() {
                let body = document.body;
                let themeIcon = document.getElementById("themeIcon");
                if (body.dataset.bsTheme === "dark") {
                    body.dataset.bsTheme = "light";
                    themeIcon.classList.remove("fa-moon");
                    themeIcon.classList.add("fa-sun");
                    document.body.classList.remove('dark-mode');
                } else {
                    body.dataset.bsTheme = "dark";
                    themeIcon.classList.remove("fa-sun");
                    themeIcon.classList.add("fa-moon");
                    document.body.classList.add('dark-mode');
                }
            });
        });
        // Congig navigation
        document.addEventListener("DOMContentLoaded", function () {
            const navLinks = document.querySelectorAll(".navbar-nav .nav-link");
            const forms = document.querySelectorAll(".admin-form");
            const activeItem = localStorage.getItem("activeNavItem");
            let themeIcon = document.getElementById("themeIcon");
            if (activeItem) {
                navLinks.forEach(link => {
                    link.classList.remove("active", "bg-info","bg-opacity-10","border-bottom","border-2", "border-info","rounded-1");
                    if (link.dataset.form === activeItem) {
                        link.classList.add("active", "bg-info","bg-opacity-10","border-bottom","border-2","border-info","rounded-1");
                    }
                });
                forms.forEach(form => form.classList.add("d-none"));
                document.getElementById(activeItem)?.classList.remove("d-none");
            }
            navLinks.forEach(link => {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    forms.forEach(form => form.classList.add("d-none"));
                    document.getElementById(this.dataset.form)?.classList.remove("d-none");
                    navLinks.forEach(nav => nav.classList.remove("active", "bg-info","bg-opacity-10","border-bottom","border-2", "border-info","rounded-1"));
                    this.classList.add("active", "bg-info","bg-opacity-10","border-bottom" ,"border-2", "border-info","rounded-1");
                    localStorage.setItem("activeNavItem", this.dataset.form);
                });
            });
        });
        // Toggle form
        document.addEventListener("DOMContentLoaded", function () {
        // Xử lý nút Add để hiển thị form
            document.querySelectorAll(".add-form").forEach(button => {
                button.addEventListener("click", function () {
                    let targetForm = document.querySelector(this.getAttribute("data-target"));
                    if (targetForm) {
                        targetForm.classList.remove("d-none");
                        targetForm.reset(); 
                        targetForm.querySelectorAll("textarea").forEach(textarea => {
                            if ($(textarea).hasClass("summernote")) {
                                if ($(textarea).data('summernote')) {
                                    $(textarea).summernote('code', '');
                                }
                            }
                        });
                        if (targetForm.querySelector("img")) {
                            targetForm.querySelectorAll("img").forEach(img => {
                                img.src = ""; 
                            });
                        }
                        targetForm.removeAttribute("data-id");
                    }
                });
            });

            // Xử lý nút Cancel để ẩn form
            document.querySelectorAll(".cancel-form").forEach(button => {
                button.addEventListener("click", function (event) {
                    event.preventDefault();
                    let parentForm = this.closest(".show-form-add");
                    if (parentForm) {
                        parentForm.classList.add("d-none"); 
                        parentForm.reset();
                        targetForm.querySelectorAll("textarea").forEach(textarea => {
                            if ($(textarea).hasClass("summernote")) {
                                if ($(textarea).data('summernote')) {
                                    $(textarea).summernote('code', '');
                                }
                            }
                        }); 
                        if (targetForm.querySelector("img")) {
                            targetForm.querySelectorAll("img").forEach(img => {
                                img.src = ""; 
                            });
                        }
                        parentForm.removeAttribute("data-id"); 
                    }
                });
            });

        });
            
        // Get data and config summernote
        document.addEventListener("DOMContentLoaded", function () {
            // Define toast
            const toastSuccess = document.getElementById("toastSuccess");
            const toast_show_success = new bootstrap.Toast(toastSuccess);
            const toastError = document.getElementById("toastError");
            const toast_show_error = new bootstrap.Toast(toastError);
            // Define textarea
            const textAreas = ["about", "sumary", "des_about_1", "des_about_2", "des_about_3", "des_about_4", "description_edu", "description_project", "description_experience"];
            textAreas.forEach(id => {
                $(`#${id}`).summernote({
                    placeholder: 'Write here...',
                    tabsize: 2,
                    height: 100,
                    toolbar: [
                        ['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']], 
                        ['font', ['fontname', 'fontsize', 'color']], 
                        ['para', ['ul', 'ol', 'paragraph', 'align']], 
                        ['insert', ['link', 'picture', 'video', 'hr']],  
                        ['table', ['table']],  
                        ['misc', ['fullscreen', 'codeview', 'undo', 'redo', 'help']]  
                    ]

                });
            });
            function getDataAPiProfile(){
                const apiUrl = "/profile";  
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        fillProfileForm(data);
                    })
                    .catch(error => console.error("Lỗi khi lấy dữ liệu profile:", error));
            }
                
            function fillProfileForm(data) {
                const form = document.getElementById("profileForm");
                if (!form) {
                    console.error("Không tìm thấy form profile!");
                    return;
                }

                Object.keys(data).forEach(key => {
                    let input = form.querySelector(`[name="${key}"]`);
                    
                    if (input) {
                        if (input.type === "file") {
                            // Không thể gán giá trị cho input file, chỉ cập nhật ảnh preview nếu có
                            if (key === "avatar" && data.avatar) {
                                document.getElementById("avatarPreview").src = "." + data.avatar;
                            }
                            if (key === "background" && data.background) {
                                document.getElementById("backgroundPreview").src ="." + data.background;
                            }
                        } else if (input.tagName.toLowerCase() === "textarea") {
                            textAreas.forEach(id => {
                                if ($(`#${id}`).summernote) {
                                    $(`#${id}`).summernote('code', data[id] || "");
                                }
                            });

                        } else {
                            input.value = data[key];  
                        }
                }
                });
                
            }
            function fetchSkill() {
                fetch("/skills")
                    .then(response => response.json())
                    .then(data => {
                        const skillContainer = document.querySelector(".table-skill-fech tbody");
                        let content = "";
                        data.forEach(skill => {
                            content += `
                            <tr>
                                <td>${skill.id}</td>
                                <td>${skill.skill}</td>
                                <td>${skill.percentage}%</td>
                                <td>
                                    <button class="btn btn-warning btn-sm me-2 btn-edit-skill" data-target-id ="${skill.id}"><i class="fa fa-edit"></i> Edit</button>
                                    <button class="btn btn-danger btn-sm btn-delete-skill" data-target-id ="${skill.id}"><i class="fa fa-trash"></i> Delete</button>
                                </td>
                            </tr>
                            `;
                        });
                        skillContainer.innerHTML = content;

                        // Gán sự kiện khi click vào nút Edit
                        document.querySelectorAll(".btn-edit-skill").forEach(button => {
                            button.addEventListener("click", function () {
                                const skillId = this.getAttribute("data-target-id");
                                showFormEditSkill(skillId);
                            });
                        });
                        document.querySelectorAll(".btn-delete-skill").forEach(button => {
                            button.addEventListener("click", function () {
                                const skillId = this.getAttribute("data-target-id");
                                deleteSkill(skillId);
                            });
                        });
                    })
                    .catch(error => console.error("Error loading skills:", error));
            }
            function showFormEditSkill(skillId) {
                fetch(`/skills/${skillId}`)
                    .then(response => response.json())
                    .then(data => {
                        const form = document.querySelector("#skillForm");
                        Object.keys(data).forEach(key => {
                            let input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                input.value = data[key];
                            }
                        });
                        form.setAttribute("data-id", skillId);
                        form.classList.remove("d-none");
                    })
                    .catch(error => console.error("Error fetching skill:", error));
            }
            function deleteSkill(skillId){
                if (confirm("Are you sure you want to delete this skill?")) {
                    fetch(`/skills/${skillId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            toast_show_success.show();
                            fetchSkill(); 
                        } else {
                            toast_show_error.show()
                            console.error("Error deleting skill:", response.statusText);
                        }
                    })
                    .catch(error => {
                        toast_show_error.show();
                        console.error("Error deleting skill:", error);

                    });
                }
            }
            function fetchEducation() {
                fetch("/education")
                    .then(response => response.json())
                    .then(data => {
                        const EducationContainer = document.querySelector(".table-education-fech tbody");
                        let content = "";
                        data.forEach(education => {
                            content += `
                            <tr>
                                <td>${education.id}</td>
                                <td>${education.degree.substring(0, 50)}...</td>
                                <td>${education.school.substring(0, 50)}...</td>
                                <td>${education.description.substring(0, 50)}...</td>
                                <td>${education.year}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm me-2 mb-2 btn-edit-education" data-target-id ="${education.id}"><i class="fa fa-edit"></i> Edit</button>
                                    <button class="btn btn-danger btn-sm mb-2 btn-delete-education" data-target-id ="${education.id}"><i class="fa fa-trash"></i> Delete</button>
                                </td>
                            </tr>
                            `;
                        });
                        EducationContainer.innerHTML =content;
                        // Gán sự kiện khi click vào nút Edit
                        document.querySelectorAll(".btn-edit-education").forEach(button => {
                            button.addEventListener("click", function () {
                                const educationId = this.getAttribute("data-target-id");
                                showFormEditEducation(educationId);
                            });
                        });
                        document.querySelectorAll(".btn-delete-education").forEach(button => {
                            button.addEventListener("click", function () {
                                const educationId = this.getAttribute("data-target-id");
                                deleteEducation(educationId);
                            });
                        });
                    })
                    .catch(error => console.error("Error loading experiences:", error));
            }
            function showFormEditEducation(educationId) {
                fetch(`/education/${educationId}`)
                    .then(response => response.json())
                    .then(data => {
                        const form = document.querySelector("#educationForm");
                        Object.keys(data).forEach(key => {
                            let input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.tagName.toLowerCase() === "textarea") {
                                    if ($(`#${input.id}`).summernote) {
                                        $(`#${input.id}`).summernote('code', data[key] || "");
                                    }
                                } else {
                                    input.value = data[key];
                                }
                            }
                        });
                        form.setAttribute("data-id", educationId);
                        form.classList.remove("d-none");
                    })
                    .catch(error => console.error("Error fetching education:", error));
            }
            function deleteEducation(educationId){
                if (confirm("Are you sure you want to delete this education?")) {
                    fetch(`/education/${educationId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            toast_show_success.show();
                            fetchEducation(); 
                        } else {
                            toast_show_error.show();
                            console.error("Error deleting education:", response.statusText);
                        }
                    })
                    .catch(error => {
                        toast_show_error.show()
                        console.error("Error deleting education:", error);});
                }
            }
            function fetchProjects() {
                fetch("/projects")
                    .then(response => response.json())
                    .then(data => {
                        const ProjectsContainer = document.querySelector(".table-projects-fech tbody");
                        let content = "";
                        data.forEach(projects => {
                            content += `
                            <tr>
                                <td>${projects.id}</td>
                                <td>${projects.title.substring(0, 50)}</td>
                                <td>${projects.description.substring(0, 50)}</td>
                                <td><img src="${projects.image}" width="100" height="100"></td>
                                <td>${projects.project_date}</td>
                                <td>${projects.category}</td>
                                <td>${projects.client}</td>
                                <td>${projects.github_link}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm me-2 mb-2 btn-edit-project" data-target-id ="${projects.id}"><i class="fa fa-edit"></i> Edit</button>
                                    <button class="btn btn-danger btn-sm mb-2 btn-delete-project" data-target-id ="${projects.id}"><i class="fa fa-trash"></i> Delete</button>
                                </td>
                            </tr>
                            `;
                        });
                        ProjectsContainer.innerHTML =content;
                        // Gán sự kiện khi click vào nút Edit
                        document.querySelectorAll(".btn-edit-project").forEach(button => {
                            button.addEventListener("click", function () {
                                const projectId = this.getAttribute("data-target-id");
                                showFormEditProject(projectId);
                            });
                        });
                        document.querySelectorAll(".btn-delete-project").forEach(button => {
                            button.addEventListener("click", function () {
                                const projectId = this.getAttribute("data-target-id");
                                deleteProject(projectId);
                            });
                        });
                    })
                    .catch(error => console.error("Error loading experiences:", error));
            }
            function showFormEditProject(projectId) {
                const spinner = document.querySelector("#loadingSpinner");
                // Hiển thị spinner trước khi gọi API
                if (spinner) {
                    spinner.classList.remove("d-none");
                }
                fetch(`/projects/${projectId}`)
                    .then(response => response.json())
                    .then(data => {
                        const form = document.querySelector("#projectForm");
                        Object.keys(data).forEach(key => {
                            let input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.tagName.toLowerCase() === "textarea") {
                                    if ($(`#${input.id}`).summernote) {
                                        $(`#${input.id}`).summernote('code', data[key] || "");
                                    }
                                } 
                                else if (input.type === "file"){
                                    document.getElementById("projectImagePreview").src = "." + data.image;
                                }
                                else if (input.tagName.toLowerCase() === "select") {
                                    // Nếu input là <select>, gán giá trị vào select
                                    let option = input.querySelector(`option[value="${data[key]}"]`);
                                    if (option) {
                                        input.value = data[key]; // Gán giá trị cho select
                                    }
                                } 
                                else {
                                    input.value = data[key];
                                }
                            }
                        });
                        form.setAttribute("data-id", projectId);
                        form.classList.remove("d-none");
                    })
                    .catch(error => console.error("Error fetching project:", error))
                    .finally(() => {
                        if (spinner) {
                            spinner.classList.add("d-none");
                        }
                    });
            }
            function deleteProject(projectId){
                if (confirm("Are you sure you want to delete this projects?")) {
                    fetch(`/projects/${projectId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            toast_show_success.show();
                            fetchProjects(); 
                        } else {
                            toast_show_error.show();
                            console.error("Error deleting projects:", response.statusText);
                        }
                    })
                    .catch(error => {
                        toast_show_error.show()
                        console.error("Error deleting projects:", error);});
                }
            }
            function fetchExperiences() {
                fetch("/experience")
                    .then(response => response.json())
                    .then(data => {
                        const ExperienceContainer = document.querySelector(".table-experience-fech tbody");
                        let content = "";
                        data.forEach(experience => {
                            content += `
                            <tr>
                                <td>${experience.id}</td>
                                <td>${experience.position.substring(0, 50)}</td>
                                <td>${experience.company.substring(0, 50)}</td>
                                <td>${experience.description.substring(0, 50)}...</td>
                                <td>${experience.start_date}</td>
                                <td>${experience.end_date}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm me-2 mb-2 btn-edit-experience" data-target-id ="${experience.id}"><i class="fa fa-edit"></i> Edit</button>
                                    <button class="btn btn-danger btn-sm mb-2 btn-delete-experience" data-target-id ="${experience.id}"><i class="fa fa-trash"></i> Delete</button>
                                </td>
                            </tr>
                            `;
                        });
                        ExperienceContainer.innerHTML =content;
                        // Gán sự kiện khi click vào nút Edit
                        document.querySelectorAll(".btn-edit-experience").forEach(button => {
                            button.addEventListener("click", function () {
                                const experienceId = this.getAttribute("data-target-id");
                                showFormEditExperience(experienceId);
                            });
                        });
                        document.querySelectorAll(".btn-delete-experience").forEach(button => {
                            button.addEventListener("click", function () {
                                const experienceId = this.getAttribute("data-target-id");
                                deleteExperience(experienceId);
                            });
                        });
                    })
                    .catch(error => console.error("Error loading experiences:", error));
            }
            function showFormEditExperience(experienceId) {
                const spinner = document.querySelector("#loadingSpinner");
                // Hiển thị spinner trước khi gọi API
                if (spinner) {
                    spinner.classList.remove("d-none");
                }
                fetch(`/experience/${experienceId}`)
                    .then(response => response.json())
                    .then(data => {
                        const form = document.querySelector("#experienceForm");
                        Object.keys(data).forEach(key => {
                            let input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.tagName.toLowerCase() === "textarea") {
                                    if ($(`#${input.id}`).summernote) {
                                        $(`#${input.id}`).summernote('code', data[key] || "");
                                    }
                                } else {
                                    input.value = data[key];
                                }
                            }
                        });
                        form.setAttribute("data-id", experienceId);
                        form.classList.remove("d-none");
                    })
                    .catch(error => console.error("Error fetching experience:", error))
                    .finally(() => {
                        if (spinner) {
                            spinner.classList.add("d-none");
                        }
                    });
            }
            function deleteExperience(experienceId){
                if (confirm("Are you sure you want to delete this experience?")) {
                    fetch(`/experience/${experienceId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            toast_show_success.show();
                            fetchExperiences(); 
                        } else {
                            toast_show_error.show();
                            console.error("Error deleting experience:", response.statusText);
                        }
                    })
                    .catch(error => {
                        toast_show_error.show()
                        console.error("Error deleting experience:", error);});
                }
            }
            fetchSkill();
            fetchEducation();
            fetchProjects();
            fetchExperiences();
            getDataAPiProfile();

            document.querySelector("#projectForm").addEventListener("submit", function (event) {
                async function ChangeProjectCommit(event) {
                    event.preventDefault();
                    try {
                        let form = document.getElementById("projectForm");
                        const projectId = form.getAttribute("data-id");
                        let url = "/projects";
                        let method = "POST";

                        if (projectId) {
                            url = `/projects/${projectId}`;
                            method = "PUT";
                        }
                        const formData = new FormData(form);
                        let imageFile = document.querySelector("[name='image']").files[0];
                        if (imageFile) {
                            formData.append("image", imageFile);
                        }
                        const textAreas = ["description_project"];
                        textAreas.forEach(id => {
                            if ($(`#${id}`).summernote) {
                                formData.append(id, $(`#${id}`).summernote('code'));
                            }
                        });

                        // Gửi request
                        const response = await fetch(url, {
                            method: method,
                            body: formData,
                        });

                        // Kiểm tra nếu request thất bại
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        const data = await response.json();
                        toast_show_success.show();
                        console.log("Success:", data);
                        fetchProjects();
                        form.reset();
                        form.classList.add("d-none");
                        form.removeAttribute("data-id");

                    } catch (error) {
                        console.error("Error:", error);
                        toast_show_error.show();
                    }
                }

                ChangeProjectCommit(event);
            });
            document.querySelector("#experienceForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const experienceId = this.getAttribute("data-id");
                const formData = new FormData(this);

                let url = "/experience";
                let method = "POST"; 

                if (experienceId) {
                    url = `/experience/${experienceId}`;
                    method = "PUT"; 
                }
                formData.forEach((value, key) => {
                    const textarea = document.querySelector(`#${key}`);
                    if (textarea && $(textarea).hasClass("summernote")) {
                        formData.set(key, $(`#${key}`).summernote('code'));
                    }
                });
                const checkbox_enddate = document.querySelector(`#checkbox_endate`);
                if (checkbox_enddate.checked) {
                    formData.set('end_date', 'Present');
                }
                fetch(url, {
                    method: method,
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: { "Content-Type": "application/json" }
                })
                .then(response => response.json())
                .then(data => {
                    toast_show_success.show();
                    console.log("Success:", data)
                    fetchExperiences();
                    this.reset(); 
                    this.classList.add("d-none"); 
                    this.removeAttribute("data-id");
                })
                .catch(error => {
                    console.error("Error:", error);
                    toast_show_error.show();
                });
            });
            document.querySelector("#educationForm").addEventListener("submit", function (event) {
                event.preventDefault();
                const educationId = this.getAttribute("data-id");
                const formData = new FormData(this);

                let url = "/education";
                let method = "POST"; 

                if (educationId) {
                    url = `/education/${educationId}`;
                    method = "PUT"; 
                }
                formData.forEach((value, key) => {
                    const textarea = document.querySelector(`#${key}`);
                    if (textarea && $(textarea).hasClass("summernote")) {
                        formData.set(key, $(`#${key}`).summernote('code'));
                    }
                });
                fetch(url, {
                    method: method,
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: { "Content-Type": "application/json" }
                })
                .then(response => response.json())
                .then(data => {
                    toast_show_success.show();
                    console.log("Success:", data)
                    fetchEducation();
                    this.reset(); 
                    this.classList.add("d-none"); 
                    this.removeAttribute("data-id");
                })
                .catch(error => {
                    console.error("Error:", error);
                    toast_show_error.show();
                });
            });
            document.querySelector("#skillForm").addEventListener("submit", function (event) {
                event.preventDefault(); 

                const skillId = this.getAttribute("data-id");
                const formData = new FormData(this);

                let url = "/skills";
                let method = "POST"; 

                if (skillId) {
                    url = `/skills/${skillId}`;
                    method = "PUT"; 
                }

                fetch(url, {
                    method: method,
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: { "Content-Type": "application/json" }
                })
                .then(response => response.json())
                .then(data => {
                    toast_show_success.show();
                    console.log("Success:", data)
                    fetchSkill();
                    this.reset(); 
                    this.classList.add("d-none"); 
                    this.removeAttribute("data-id");
                })
                .catch(error => {
                    console.error("Error:", error);
                    toast_show_error.show();
                });
            });
            document.querySelector("#profileForm").addEventListener("submit", function (event) {
                event.preventDefault(); 
                async function updateProfile() {
                    let form = document.getElementById("profileForm");
                    let formData = new FormData(form);

                    let avatarFile = document.querySelector("[name='avatar']").files[0];
                    let backgroundFile = document.querySelector("[name='background']").files[0];

                    if (avatarFile) {
                        formData.append("avatar", avatarFile);
                    }
                    if (backgroundFile) {
                        formData.append("background", backgroundFile);
                    }
                    const textAreas = ["about", "sumary", "des_about_1", "des_about_2", "des_about_3", "des_about_4"];
                    textAreas.forEach(id => {
                        if ($(`#${id}`).summernote) {
                            formData.append(id, $(`#${id}`).summernote('code'));
                        }
                    });
                    console.log([...formData.entries()]);
                    try {
                        let response = await fetch("/profile", {
                            method: "PUT",
                            body: formData,  
                        });

                        if (!response.ok) {
                            throw new Error(`Lỗi HTTP: ${response.status}`);
                        }

                        let result = await response.json();
                        console.log("Cập nhật thành công:", result);
                        toast_show_success.show();
                        getDataAPiProfile();
                    } catch (error) {
                        console.error("Lỗi khi cập nhật profile:", error);
                        toast_show_error.show();
                    }
                }
                updateProfile();

            });
            });
        function displayImage(input, previewId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById(previewId).src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        document.querySelector("[name='avatar']").addEventListener("change", function () {
            displayImage(this, "avatarPreview");
        });
        document.querySelector("[name='background']").addEventListener("change", function () {
            displayImage(this, "backgroundPreview");
        });
        document.querySelector("[name='image']").addEventListener("change",function(){
            displayImage(this, "projectImagePreview");
        });
        
    </script>
  
    <!-- Toast Section -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="toastSuccess" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    Cập nhật thành công!
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>
    <div id="toastError" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Đã xảy ra lỗi!
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
